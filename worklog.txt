-Runs on 19/02 seems to imply own ff_farfield function ~<=> meeps own function for closed surface in air. own ff function also faster. This warrants further testing. 
Things to test for. Time? Sim time was 5 sec. Increase? Also, polarization was Ey. Test for different polarisation. Why is far field not equal to close field? Increased resolution needed? Too big of a difference probably. What else could it be.. According to poyntings theorem, should be the same. Ardavan Oskooi claims it shouldn't. Further testing needed. Only used 2 fold symmetry here.

Why on earth does the ff change with different polarisation? Makes no sense.

Run on 20/02. Increase sim time slightly and try other polarisation. 3-fold symmetry used to increase run-time.

21/02. Figure out why Ex and Ey polarisation is different? Should be the same for geometry ff fields? When completed, figure out the needed resolution for converged ff calculations. Seems to be fixed. ff within ~1% for res 40 and 160. Check ff ratio for theta=pi/6 same as analytical answer?

25/02 Does DPML layers affect anything? Do I need to increase it for higher resolution? Increased resolution seems to increase far field flux? Dependent on npts or something else? Future problem? It seems that ff needs all sides of the simulation, check this. Can I only make do with the upper ff field? Is it depending on r? Check for different r. Discuss with Fredrik.

Check DPML layers and npts for higher res. Test MEEPs far field vs my own.

what r should we have? solved - doesnt matter. whole point of the far field.

06/03 Total flux differs for different source pos and sim_time=15. (obviously). Use same total flux (flux from source without geometry) for all simulations? Removes total flux calculation time and same comparison for total flux for all sims. Also, ff field is not covering whole sim cell. So higher source pos might have bigger difference. Adding probe for sim time is not optimal but seems to be required. This furthers investigation on cut-off time for source as well..

13/03 Check if to add some air and extend ff layers and comment on results. That we I can ignore that possibility hopefully. I think prio now is narrow down the simulation space so I can continue on with output and optimization. Check dpmls, ff&air, ff calculation differences. Anything else? If not, move on to optimization hopefully.

14/03 Oh boy, making sim cell a function of pyramid size could bring trouble. First and foremost. If the ratio between sh and ph is constant, is flux ratio the same? Hopefully, otherwise I have some trouble (?). I need to check this. Larger sim cells seems to require longer sim times. Would make sense. waves in air travel at 1v. I want the sim cell as small as possible. total flux is a function of sim cell size and sh, but ff flux isn't. So it makes sense to make sh as small as possible. I just need to check that larger sim cells with ratio consant converges. 

15/03 Find a good time convergence criteria. Measure total flux every sec? Might be very time consuming. Probing seems difficult to find a good balance between different sim specs (?). Different geometries require different sim times. Discuss with Nisse and Torbj√∂rn.

Implement sim for several frequencies. Done.

Try comparing my ff calcs with meeps. Is mine close enough? Also, convergence criteria. Take an upper limit on time or implement some based on total flux? upper time seems simpler. Just need to find it. Check dpml differences for higher resolutions

dpml seems to be ok. upper limit 30 time units possibly? check ff with flux angle? run time seems dependent on height and freq a lot?

<<<<<<< HEAD
for large time to flux diverges. Why? Need to investigate both dpml and absorbers. First of, do we need just thicker dpml/absorbers? Eventually. Why do they only diverge after a large amount of time? t>360 for absorbers and cutoff=10. t>180 cutoff=2 for dpml. TODO: plot
=======
Compare array get metadata integral with my own.. 

Results differ a lot when changing polarization to Ey. Need to redo a lot of runs to get some 1D plots. check how much energy convergence and runnig for fixed time differs. for res 40 seems to be about 2% 

TODO:

Importance 1: Check how to implement utility function and automate the process
Importance 2: Compare my ff calcs with meep, compare array get metadata integal with my own check how varying sim cell sizes affect output
Importance 3:Time differs from fixed sim time to energy convergence.
<<<<<<< HEAD

run 0 finished at t = 35.0 (5600 timesteps)
time taken: 0.052671194076538086
Total_Flux: [24.251325775153624] Flux_ff: [0.95142467] ratio: [0.03923186] sim_time: 35 dpml: 0.1 res: 80 source_pos: 0.08 p_height: 3.0 p_width: 3.0 freqs: [2.0]
Flux at an angle / Total flux: [0.10526799982001889]

Elapsed run time = 2396.6479 s

run 0 finished at t = 40.00625 (6401 timesteps)
time taken: 0.004448890686035156
Total_Flux: [24.252193691072527] Flux_ff: [0.95121561] ratio: [0.03922184] sim_time: 40.00625 dpml: 0.1 res: 80 source_pos: 0.08 p_height: 3.0 p_width: 3.0 freqs: [2.0]

Elapsed run time = 2675.3661 s

Field time usage:
     connecting chunks: 15.6827 s
         time stepping: 1015.62 s
         communicating: 158.76 s
    Fourier transforming: 382.933 s
       everything else: 60.1996 s

run 0 finished at t = 40.0 (6400 timesteps)
time taken: 0.031694889068603516
Total_Flux: [24.25219133501465] Flux_ff: [0.95121566] ratio: [0.03922184] sim_time: 40 dpml: 0.1 res: 80 source_pos: 0.08 p_height: 3.0 p_width: 3.0 freqs: [2.0]

Elapsed run time = 2561.6147 s

Field time usage:
     connecting chunks: 13.0236 s
         time stepping: 986.527 s
         communicating: 159.787 s
    Fourier transforming: 373.715 s
       everything else: 47.3579 s

=======
>>>>>>> f52a4f01a5a00b30a944442baac43065471cfbad
>>>>>>> 8e7e12e1b92d48b0f9f69a933c2ca7fe658923e0
